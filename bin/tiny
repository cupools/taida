#!/usr/bin/env node

var program = require('commander')
var PKG = require('../package.json')
var tiny = require('../lib/cmd/tiny').default

program
  .version(PKG.version)
  .usage('[options] [files ...]')
  .option('-d, --dest <path>', 'directory path to output images')
  .option('    --detail', 'show more detail')
  .option('    --no-alternate', 'only use the first apikey even though invalid')
  .option('    --no-backup', 'do not backup latest compressed bitmaps for restore')
  .on('--help', function () {
    console.log(
      [
        '  Examples:',
        '',
        '    $ tiny images/banner.png',
        '    $ tiny **/*.{png,jpg} --dest ./compress',
        '    $ tiny-apikey add apikeyfromtinypng',
        ''
      ]
      .join('\n')
    )
  })

program
  .command('restore')
  .description('restore the latest compressed bitmaps')
  .action(function () {
    tiny.restore()
  })

program.parse(process.argv)

if (!program.args[0] || program.args[0].constructor !== program.Command) {
  var pattern = program.args.length ? program.args : ['*.png']
  var dest = program.dest
  var detail = !!program.detail
  var alternate = !!program.alternate
  var backup = !!program.backup

  tiny.main({
    pattern: pattern,
    dest: dest,
    detail: detail,
    alternate: alternate,
    backup: backup
  })
}
