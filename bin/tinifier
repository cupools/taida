#!/usr/bin/env node
'use strict'

var program = require('commander')
var PKG = require('../package.json')
var main = require('../lib/cmd/main').default

program
  .version(PKG.version)
  .option('-p, --pattern [globs...]', 'glob pattern for images filepath to compress')
  .option('-d, --dest [path]', 'directory path to save compressed images')
  .parse(process.argv)

if (program.pattern) {
  // get correct filepath array
  let pattern = program.rawArgs
      .slice(2)
      .reduce(
        (ret, arg) => {
          if (arg === '-p' || arg === '--pattern') {
            // mark start
            return ret.concat(null)
          } else if (ret[0] === null && arg[0] === '-') {
            // mark end
            return ret.concat(null)
          } else if (ret[0] === null && arg[0] !== '-') {
            // expected arguments
            if (ret.length === 1 || ret[ret.length - 1] !== null) {
              return ret.concat(arg)
            }
          }
          return ret
        },
        []
      )
      .filter(arg => !!arg)

  return main({
    pattern
  })
}
